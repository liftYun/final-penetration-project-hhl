<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.home.Heo.house.repository.HouseDao">

	
	<select id="findHouseByAptSeq" parameterType="String"   resultType="com.ssafy.home.Heo.house.entity.HouseEntity">
		SELECT
			apt_seq,
			sgg_cd,
			umd_cd,
			umd_nm,
			jibun,
			road_nm_sgg_cd,
			road_nm,
			road_nm_bonbun,
			road_nm_bubun,
			apt_nm,
			build_year,
			latitude,
			longitude
		FROM houseinfos
		WHERE apt_seq = #{aptSeq}
	</select>
	<select id="getHouseListCount" resultType="int">
		SELECT COUNT(*) FROM houseinfos
	</select>
	<select id="getHouseList"
			parameterType="com.ssafy.home.Heo.common.page.PageRequestDto"
			resultType="com.ssafy.home.Heo.house.entity.HouseEntity">
		SELECT
			apt_seq,
			sgg_cd,
			umd_cd,
			umd_nm,
			jibun,
			road_nm_sgg_cd,
			road_nm,
			road_nm_bonbun,
			road_nm_bubun,
			apt_nm,
			build_year,
			latitude,
			longitude
		FROM houseinfos
		ORDER BY build_year DESC
		LIMIT #{size} OFFSET #{offset}
	</select>

	<!--검색조건[시군구 코드+읍면동 코드] + 정렬조건으로 페이지네이션-->
	<select id="getHouseCountByCondition"
			parameterType="com.ssafy.home.Heo.house.condition.SearchCondition"
			resultType="int">
		SELECT count(*)
		FROM houseinfos hi
		WHERE hi.sgg_cd = #{sggCd}
		<if test="umdCd != null and umdCd != ''">
			AND hi.umd_cd = #{umdCd}
		</if>
	</select>

	<select id="findHousesByCondition"
			parameterType="com.ssafy.home.Heo.common.page.PageRequestDto"
			resultType="com.ssafy.home.Heo.house.entity.HouseEntity">
		SELECT
			apt_seq,
			sgg_cd,
			umd_cd,
			umd_nm,
			jibun,
			road_nm_sgg_cd,
			road_nm,
			road_nm_bonbun,
			road_nm_bubun,
			apt_nm,
			build_year,
			latitude,
			longitude
		FROM houseinfos hi
		WHERE hi.sgg_cd = #{sggCd}
		<if test="umdCd != null and umdCd != ''">
			AND hi.umd_cd = #{umdCd}
		</if>
		<choose>
			<when test="orderCondition != null and orderCondition.name() == 'BUILD_YEAR_ASC'">
				ORDER BY hi.build_year ASC
			</when>
			<when test="orderCondition != null and orderCondition.name() == 'BUILD_YEAR_DESC'">
				ORDER BY hi.build_year DESC
			</when>
		</choose>
		LIMIT #{size} OFFSET #{offset}
	</select>
	
</mapper>